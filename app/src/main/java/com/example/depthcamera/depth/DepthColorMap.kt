package com.example.depthcamera.depth

import android.graphics.Bitmap
import android.graphics.Color
import android.util.Size
import com.example.depthcamera.performance.PerformanceInfo

/** @param input values should be between 0.0f and 1.0f */
fun depthColorMap(input: FloatArray, inputImageSize: Size): Bitmap =
	PerformanceInfo.measureScope("Depth colormap") {
		val depthPixels = IntArray(inputImageSize.width * inputImageSize.height)

		for (i in 0 until input.size) {
			depthPixels[i] = depthToInfernoColor(input[i])
		}

		return@measureScope Bitmap.createBitmap(
			depthPixels,
			inputImageSize.width,
			inputImageSize.height,
			Bitmap.Config.RGB_565
		)
	}

/**
 * @param relativeDepth between 0.0f and 1.0f
 * @return [Int] (return from Color.rgb(...))
 */
fun depthToInfernoColor(relativeDepth: Float): Int {
	val index = (relativeDepth.coerceAtLeast(0.0f).coerceAtMost(1.0f) * (infernoColors.size - 1)).toInt()
	return infernoColors[index]
}

/**
 * Inferno Colormap: index is depth (0..255)
 * value based on: https://github.com/kennethmoreland-com/kennethmoreland-com.github.io/blob/master/color-advice/inferno/inferno-table-byte-0256.csv
 */
private val infernoColors =
	arrayOf(
		Color.rgb(0, 0, 4),
		Color.rgb(1, 0, 5),
		Color.rgb(1, 1, 6),
		Color.rgb(1, 1, 8),
		Color.rgb(2, 1, 10),
		Color.rgb(2, 2, 12),
		Color.rgb(2, 2, 14),
		Color.rgb(3, 2, 16),
		Color.rgb(4, 3, 18),
		Color.rgb(4, 3, 20),
		Color.rgb(5, 4, 23),
		Color.rgb(6, 4, 25),
		Color.rgb(7, 5, 27),
		Color.rgb(8, 5, 29),
		Color.rgb(9, 6, 31),
		Color.rgb(10, 7, 34),
		Color.rgb(11, 7, 36),
		Color.rgb(12, 8, 38),
		Color.rgb(13, 8, 41),
		Color.rgb(14, 9, 43),
		Color.rgb(16, 9, 45),
		Color.rgb(17, 10, 48),
		Color.rgb(18, 10, 50),
		Color.rgb(20, 11, 52),
		Color.rgb(21, 11, 55),
		Color.rgb(22, 11, 57),
		Color.rgb(24, 12, 60),
		Color.rgb(25, 12, 62),
		Color.rgb(27, 12, 65),
		Color.rgb(28, 12, 67),
		Color.rgb(30, 12, 69),
		Color.rgb(31, 12, 72),
		Color.rgb(33, 12, 74),
		Color.rgb(35, 12, 76),
		Color.rgb(36, 12, 79),
		Color.rgb(38, 12, 81),
		Color.rgb(40, 11, 83),
		Color.rgb(41, 11, 85),
		Color.rgb(43, 11, 87),
		Color.rgb(45, 11, 89),
		Color.rgb(47, 10, 91),
		Color.rgb(49, 10, 92),
		Color.rgb(50, 10, 94),
		Color.rgb(52, 10, 95),
		Color.rgb(54, 9, 97),
		Color.rgb(56, 9, 98),
		Color.rgb(57, 9, 99),
		Color.rgb(59, 9, 100),
		Color.rgb(61, 9, 101),
		Color.rgb(62, 9, 102),
		Color.rgb(64, 10, 103),
		Color.rgb(66, 10, 104),
		Color.rgb(68, 10, 104),
		Color.rgb(69, 10, 105),
		Color.rgb(71, 11, 106),
		Color.rgb(73, 11, 106),
		Color.rgb(74, 12, 107),
		Color.rgb(76, 12, 107),
		Color.rgb(77, 13, 108),
		Color.rgb(79, 13, 108),
		Color.rgb(81, 14, 108),
		Color.rgb(82, 14, 109),
		Color.rgb(84, 15, 109),
		Color.rgb(85, 15, 109),
		Color.rgb(87, 16, 110),
		Color.rgb(89, 16, 110),
		Color.rgb(90, 17, 110),
		Color.rgb(92, 18, 110),
		Color.rgb(93, 18, 110),
		Color.rgb(95, 19, 110),
		Color.rgb(97, 19, 110),
		Color.rgb(98, 20, 110),
		Color.rgb(100, 21, 110),
		Color.rgb(101, 21, 110),
		Color.rgb(103, 22, 110),
		Color.rgb(105, 22, 110),
		Color.rgb(106, 23, 110),
		Color.rgb(108, 24, 110),
		Color.rgb(109, 24, 110),
		Color.rgb(111, 25, 110),
		Color.rgb(113, 25, 110),
		Color.rgb(114, 26, 110),
		Color.rgb(116, 26, 110),
		Color.rgb(117, 27, 110),
		Color.rgb(119, 28, 109),
		Color.rgb(120, 28, 109),
		Color.rgb(122, 29, 109),
		Color.rgb(124, 29, 109),
		Color.rgb(125, 30, 109),
		Color.rgb(127, 30, 108),
		Color.rgb(128, 31, 108),
		Color.rgb(130, 32, 108),
		Color.rgb(132, 32, 107),
		Color.rgb(133, 33, 107),
		Color.rgb(135, 33, 107),
		Color.rgb(136, 34, 106),
		Color.rgb(138, 34, 106),
		Color.rgb(140, 35, 105),
		Color.rgb(141, 35, 105),
		Color.rgb(143, 36, 105),
		Color.rgb(144, 37, 104),
		Color.rgb(146, 37, 104),
		Color.rgb(147, 38, 103),
		Color.rgb(149, 38, 103),
		Color.rgb(151, 39, 102),
		Color.rgb(152, 39, 102),
		Color.rgb(154, 40, 101),
		Color.rgb(155, 41, 100),
		Color.rgb(157, 41, 100),
		Color.rgb(159, 42, 99),
		Color.rgb(160, 42, 99),
		Color.rgb(162, 43, 98),
		Color.rgb(163, 44, 97),
		Color.rgb(165, 44, 96),
		Color.rgb(166, 45, 96),
		Color.rgb(168, 46, 95),
		Color.rgb(169, 46, 94),
		Color.rgb(171, 47, 94),
		Color.rgb(173, 48, 93),
		Color.rgb(174, 48, 92),
		Color.rgb(176, 49, 91),
		Color.rgb(177, 50, 90),
		Color.rgb(179, 50, 90),
		Color.rgb(180, 51, 89),
		Color.rgb(182, 52, 88),
		Color.rgb(183, 53, 87),
		Color.rgb(185, 53, 86),
		Color.rgb(186, 54, 85),
		Color.rgb(188, 55, 84),
		Color.rgb(189, 56, 83),
		Color.rgb(191, 57, 82),
		Color.rgb(192, 58, 81),
		Color.rgb(193, 58, 80),
		Color.rgb(195, 59, 79),
		Color.rgb(196, 60, 78),
		Color.rgb(198, 61, 77),
		Color.rgb(199, 62, 76),
		Color.rgb(200, 63, 75),
		Color.rgb(202, 64, 74),
		Color.rgb(203, 65, 73),
		Color.rgb(204, 66, 72),
		Color.rgb(206, 67, 71),
		Color.rgb(207, 68, 70),
		Color.rgb(208, 69, 69),
		Color.rgb(210, 70, 68),
		Color.rgb(211, 71, 67),
		Color.rgb(212, 72, 66),
		Color.rgb(213, 74, 65),
		Color.rgb(215, 75, 63),
		Color.rgb(216, 76, 62),
		Color.rgb(217, 77, 61),
		Color.rgb(218, 78, 60),
		Color.rgb(219, 80, 59),
		Color.rgb(221, 81, 58),
		Color.rgb(222, 82, 56),
		Color.rgb(223, 83, 55),
		Color.rgb(224, 85, 54),
		Color.rgb(225, 86, 53),
		Color.rgb(226, 87, 52),
		Color.rgb(227, 89, 51),
		Color.rgb(228, 90, 49),
		Color.rgb(229, 92, 48),
		Color.rgb(230, 93, 47),
		Color.rgb(231, 94, 46),
		Color.rgb(232, 96, 45),
		Color.rgb(233, 97, 43),
		Color.rgb(234, 99, 42),
		Color.rgb(235, 100, 41),
		Color.rgb(235, 102, 40),
		Color.rgb(236, 103, 38),
		Color.rgb(237, 105, 37),
		Color.rgb(238, 106, 36),
		Color.rgb(239, 108, 35),
		Color.rgb(239, 110, 33),
		Color.rgb(240, 111, 32),
		Color.rgb(241, 113, 31),
		Color.rgb(241, 115, 29),
		Color.rgb(242, 116, 28),
		Color.rgb(243, 118, 27),
		Color.rgb(243, 120, 25),
		Color.rgb(244, 121, 24),
		Color.rgb(245, 123, 23),
		Color.rgb(245, 125, 21),
		Color.rgb(246, 126, 20),
		Color.rgb(246, 128, 19),
		Color.rgb(247, 130, 18),
		Color.rgb(247, 132, 16),
		Color.rgb(248, 133, 15),
		Color.rgb(248, 135, 14),
		Color.rgb(248, 137, 12),
		Color.rgb(249, 139, 11),
		Color.rgb(249, 140, 10),
		Color.rgb(249, 142, 9),
		Color.rgb(250, 144, 8),
		Color.rgb(250, 146, 7),
		Color.rgb(250, 148, 7),
		Color.rgb(251, 150, 6),
		Color.rgb(251, 151, 6),
		Color.rgb(251, 153, 6),
		Color.rgb(251, 155, 6),
		Color.rgb(251, 157, 7),
		Color.rgb(252, 159, 7),
		Color.rgb(252, 161, 8),
		Color.rgb(252, 163, 9),
		Color.rgb(252, 165, 10),
		Color.rgb(252, 166, 12),
		Color.rgb(252, 168, 13),
		Color.rgb(252, 170, 15),
		Color.rgb(252, 172, 17),
		Color.rgb(252, 174, 18),
		Color.rgb(252, 176, 20),
		Color.rgb(252, 178, 22),
		Color.rgb(252, 180, 24),
		Color.rgb(251, 182, 26),
		Color.rgb(251, 184, 29),
		Color.rgb(251, 186, 31),
		Color.rgb(251, 188, 33),
		Color.rgb(251, 190, 35),
		Color.rgb(250, 192, 38),
		Color.rgb(250, 194, 40),
		Color.rgb(250, 196, 42),
		Color.rgb(250, 198, 45),
		Color.rgb(249, 199, 47),
		Color.rgb(249, 201, 50),
		Color.rgb(249, 203, 53),
		Color.rgb(248, 205, 55),
		Color.rgb(248, 207, 58),
		Color.rgb(247, 209, 61),
		Color.rgb(247, 211, 64),
		Color.rgb(246, 213, 67),
		Color.rgb(246, 215, 70),
		Color.rgb(245, 217, 73),
		Color.rgb(245, 219, 76),
		Color.rgb(244, 221, 79),
		Color.rgb(244, 223, 83),
		Color.rgb(244, 225, 86),
		Color.rgb(243, 227, 90),
		Color.rgb(243, 229, 93),
		Color.rgb(242, 230, 97),
		Color.rgb(242, 232, 101),
		Color.rgb(242, 234, 105),
		Color.rgb(241, 236, 109),
		Color.rgb(241, 237, 113),
		Color.rgb(241, 239, 117),
		Color.rgb(241, 241, 121),
		Color.rgb(242, 242, 125),
		Color.rgb(242, 244, 130),
		Color.rgb(243, 245, 134),
		Color.rgb(243, 246, 138),
		Color.rgb(244, 248, 142),
		Color.rgb(245, 249, 146),
		Color.rgb(246, 250, 150),
		Color.rgb(248, 251, 154),
		Color.rgb(249, 252, 157),
		Color.rgb(250, 253, 161),
		Color.rgb(252, 255, 164)
	)
